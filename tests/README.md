# PhotoEditor Demo æµ‹è¯•æ–‡æ¡£

## æµ‹è¯•æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Jest ä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œä¸ºæ ¸å¿ƒé€‚é…å™¨å’ŒçŠ¶æ€ç®¡ç†ç³»ç»Ÿæä¾›å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–ã€‚

## æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ adapters/           # é€‚é…å™¨æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ BaseImageEditorAdapter.test.js
â”‚   â”‚   â”œâ”€â”€ FabricAdapter.test.js
â”‚   â”‚   â”œâ”€â”€ KonvaAdapter.test.js
â”‚   â”‚   â””â”€â”€ AdapterManager.test.js
â”‚   â”œâ”€â”€ state/              # çŠ¶æ€ç®¡ç†æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ StateManager.test.js
â”‚   â”‚   â””â”€â”€ HistoryManager.test.js
â”‚   â””â”€â”€ example.test.js     # ç¤ºä¾‹æµ‹è¯•
â”œâ”€â”€ setup.js                # æµ‹è¯•ç¯å¢ƒè®¾ç½®
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

## è¿è¡Œæµ‹è¯•

### åŸºç¡€å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:unit

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:unit:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:unit:coverage

# CI ç¯å¢ƒè¿è¡Œæµ‹è¯•
npm run test:unit:ci
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# è¿è¡Œé€‚é…å™¨ç›¸å…³æµ‹è¯•
npm run test:unit -- adapters

# è¿è¡ŒçŠ¶æ€ç®¡ç†ç›¸å…³æµ‹è¯•
npm run test:unit -- state

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm run test:unit -- BaseImageEditorAdapter.test.js
```

## æµ‹è¯•è¦†ç›–èŒƒå›´

### é€‚é…å™¨ç³»ç»Ÿæµ‹è¯•

#### BaseImageEditorAdapter
- âœ… åˆå§‹åŒ–å’Œé”€æ¯
- âœ… å›¾åƒæ“ä½œï¼ˆåŠ è½½ã€è°ƒæ•´å¤§å°ã€è£å‰ªã€æ—‹è½¬ã€ç¿»è½¬ï¼‰
- âœ… æ»¤é•œå’Œè°ƒæ•´ï¼ˆäº®åº¦ã€å¯¹æ¯”åº¦ã€æ»¤é•œåº”ç”¨/ç§»é™¤ï¼‰
- âœ… å˜æ¢æ“ä½œï¼ˆç¼©æ”¾ã€ä½ç½®è®¾ç½®ï¼‰
- âœ… é€‰æ‹©æ“ä½œ
- âœ… çŠ¶æ€ç®¡ç†
- âœ… å¯¼å‡ºåŠŸèƒ½
- âœ… äº‹ä»¶ç³»ç»Ÿ
- âœ… æ€§èƒ½æŒ‡æ ‡
- âœ… é”™è¯¯å¤„ç†

#### FabricAdapter
- âœ… Fabric.js ç‰¹å®šåŠŸèƒ½
- âœ… Canvas æ“ä½œ
- âœ… å›¾åƒæ»¤é•œç³»ç»Ÿ
- âœ… å¯¹è±¡ç®¡ç†
- âœ… äº‹ä»¶å¤„ç†
- âœ… æ€§èƒ½ä¼˜åŒ–

#### AdapterManager
- âœ… é€‚é…å™¨åˆ›å»ºå’Œç®¡ç†
- âœ… æ´»åŠ¨é€‚é…å™¨åˆ‡æ¢
- âœ… ç¼“å­˜ç®¡ç†
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… äº‹ä»¶ç³»ç»Ÿ
- âœ… ç»Ÿè®¡ä¿¡æ¯

### çŠ¶æ€ç®¡ç†ç³»ç»Ÿæµ‹è¯•

#### StateManager
- âœ… çŠ¶æ€åˆ›å»ºå’Œæ›´æ–°
- âœ… çŠ¶æ€æŸ¥è¯¢å’Œåˆ é™¤
- âœ… çŠ¶æ€åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… çŠ¶æ€æ¯”è¾ƒ
- âœ… äº‹ä»¶ç³»ç»Ÿ
- âœ… çŠ¶æ€é™åˆ¶ç®¡ç†

## æµ‹è¯•é…ç½®

### Jest é…ç½® (jest.config.js)
- æµ‹è¯•ç¯å¢ƒï¼šjsdom
- è¦†ç›–ç‡é˜ˆå€¼ï¼š70%
- æ¨¡å—æ˜ å°„ï¼šæ”¯æŒ @ åˆ«å
- è½¬æ¢é…ç½®ï¼šæ”¯æŒ Vue æ–‡ä»¶å’Œ ES6+

### æµ‹è¯•è®¾ç½® (tests/setup.js)
- Canvas API Mock
- å›¾åƒå¤„ç† API Mock
- å­˜å‚¨ API Mock
- å…¨å±€å¯¹è±¡ Mock
- æµ‹è¯•å·¥å…·å‡½æ•°

## Mock ç­–ç•¥

### ç¬¬ä¸‰æ–¹åº“ Mock
- **Fabric.js**: å®Œæ•´çš„ Canvas å’Œæ»¤é•œ API Mock
- **Konva.js**: åŸºç¡€æ¸²æŸ“å’Œäº‹ä»¶ Mock
- **æµè§ˆå™¨ API**: Canvasã€Imageã€FileReader ç­‰

### æµ‹è¯•æ•°æ®
- æ¨¡æ‹Ÿå›¾åƒæ•°æ®
- æ¨¡æ‹Ÿ Canvas å…ƒç´ 
- æ¨¡æ‹Ÿæ–‡ä»¶å¯¹è±¡
- æ¨¡æ‹Ÿäº‹ä»¶å¯¹è±¡

## è¦†ç›–ç‡ç›®æ ‡

| ç»„ä»¶ç±»å‹ | ç›®æ ‡è¦†ç›–ç‡ | å½“å‰çŠ¶æ€ |
|---------|-----------|----------|
| é€‚é…å™¨ç³»ç»Ÿ | 80%+ | âœ… å·²å®ç° |
| çŠ¶æ€ç®¡ç† | 85%+ | âœ… å·²å®ç° |
| å·¥å…·å‡½æ•° | 90%+ | ğŸ”„ è¿›è¡Œä¸­ |
| UI ç»„ä»¶ | 70%+ | â³ å¾…å®ç° |

## æœ€ä½³å®è·µ

### æµ‹è¯•ç¼–å†™åŸåˆ™
1. **å•ä¸€èŒè´£**: æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªåŠŸèƒ½ç‚¹
2. **ç‹¬ç«‹æ€§**: æµ‹è¯•ä¹‹é—´ä¸åº”ç›¸äº’ä¾èµ–
3. **å¯è¯»æ€§**: ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
4. **å®Œæ•´æ€§**: è¦†ç›–æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æƒ…å†µ

### å‘½åè§„èŒƒ
- æµ‹è¯•æ–‡ä»¶ï¼š`*.test.js`
- æµ‹è¯•å¥—ä»¶ï¼šä½¿ç”¨ç»„ä»¶/æ¨¡å—åç§°
- æµ‹è¯•ç”¨ä¾‹ï¼šä½¿ç”¨ "åº”è¯¥..." çš„æè¿°æ ¼å¼

### Mock ä½¿ç”¨æŒ‡å—
1. ä¼˜å…ˆä½¿ç”¨ Jest å†…ç½® Mock åŠŸèƒ½
2. ä¸ºå¤æ‚çš„ç¬¬ä¸‰æ–¹åº“åˆ›å»ºä¸“é—¨çš„ Mock
3. ä¿æŒ Mock çš„ç®€å•æ€§å’Œä¸€è‡´æ€§
4. åœ¨æµ‹è¯•é—´æ­£ç¡®æ¸…ç† Mock çŠ¶æ€

## æŒç»­é›†æˆ

### CI é…ç½®
- è‡ªåŠ¨è¿è¡Œæµ‹è¯•å¥—ä»¶
- ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- è¦†ç›–ç‡é˜ˆå€¼æ£€æŸ¥
- æµ‹è¯•ç»“æœé€šçŸ¥

### è´¨é‡é—¨ç¦
- æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡
- è¦†ç›–ç‡ä¸å¾—ä½äºè®¾å®šé˜ˆå€¼
- ä¸å…è®¸è·³è¿‡æµ‹è¯•ï¼ˆé™¤éæœ‰å……åˆ†ç†ç”±ï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Canvas API é”™è¯¯
```javascript
// è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿åœ¨ setup.js ä¸­æ­£ç¡® Mock Canvas API
HTMLCanvasElement.prototype.getContext = jest.fn(() => ({...}));
```

#### 2. å¼‚æ­¥æµ‹è¯•è¶…æ—¶
```javascript
// è§£å†³æ–¹æ¡ˆï¼šå¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä½¿ç”¨ async/await
test('å¼‚æ­¥æ“ä½œ', async () => {
  await expect(asyncFunction()).resolves.toBe(expected);
}, 10000); // 10ç§’è¶…æ—¶
```

#### 3. Mock ä¸ç”Ÿæ•ˆ
```javascript
// è§£å†³æ–¹æ¡ˆï¼šåœ¨ beforeEach ä¸­é‡ç½® Mock
beforeEach(() => {
  jest.clearAllMocks();
});
```

## æ‰©å±•æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨ç›¸åº”ç›®å½•åˆ›å»º `.test.js` æ–‡ä»¶
2. éµå¾ªç°æœ‰çš„æµ‹è¯•ç»“æ„å’Œå‘½åè§„èŒƒ
3. æ·»åŠ å¿…è¦çš„ Mock å’Œè®¾ç½®
4. æ›´æ–°è¦†ç›–ç‡ç›®æ ‡

### é›†æˆæµ‹è¯•
æœªæ¥å¯ä»¥è€ƒè™‘æ·»åŠ ï¼š
- ç«¯åˆ°ç«¯æµ‹è¯• (E2E)
- è§†è§‰å›å½’æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•

## å‚è€ƒèµ„æº

- [Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/getting-started)
- [Vue Test Utils](https://vue-test-utils.vuejs.org/)
- [æµ‹è¯•æœ€ä½³å®è·µ](https://github.com/goldbergyoni/javascript-testing-best-practices)
